# KMP é¡¹ç›®é£é™©è§„é¿æ–¹æ¡ˆ

## ğŸš¨ é£é™©ç‚¹åˆ†æä¸è§£å†³æ–¹æ¡ˆ

### é£é™©ç‚¹1: ç¼ºå°‘ä¾èµ–æ³¨å…¥ - ç»„ä»¶è€¦åˆåº¦å¯èƒ½è¾ƒé«˜

#### é—®é¢˜åˆ†æ
- **é£é™©ç­‰çº§**: ğŸ”´ é«˜é£é™©
- **å½±å“èŒƒå›´**: æ•´ä¸ªé¡¹ç›®æ¶æ„
- **æ½œåœ¨é—®é¢˜**: ç»„ä»¶é—´å¼ºè€¦åˆï¼Œéš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤

#### è§£å†³æ–¹æ¡ˆ
```kotlin
// 1. é›†æˆKoinä¾èµ–æ³¨å…¥æ¡†æ¶
implementation("io.insert-koin:koin-core:3.5.6")
implementation("io.insert-koin:koin-compose:1.1.2")

// 2. åˆ›å»ºæ¨¡å—åŒ–ä¾èµ–é…ç½®
val appModule = module {
    single { HttpClient.create() }
    single { DataStoreManager(get()) }
    factory { HomeViewModel(get(), get()) }
}

// 3. ç»Ÿä¸€ä¾èµ–ç®¡ç†
object KoinInitializer {
    fun init(modules: List<Module> = emptyList()) {
        startKoin { modules(appModule, networkModule, ...) }
    }
}
```

#### å®æ–½æ•ˆæœ
- âœ… ç»„ä»¶è§£è€¦ï¼Œä¾èµ–å…³ç³»æ¸…æ™°
- âœ… ä¾¿äºå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… æ”¯æŒæ¨¡å—åŒ–å¼€å‘
- âœ… é™ä½ç»´æŠ¤æˆæœ¬

---

### é£é™©ç‚¹2: ç¼ºå°‘æ•°æ®åº“å±‚ - æ•°æ®æŒä¹…åŒ–èƒ½åŠ›æœ‰é™

#### é—®é¢˜åˆ†æ
- **é£é™©ç­‰çº§**: ğŸ”´ é«˜é£é™©
- **å½±å“èŒƒå›´**: æ•°æ®å­˜å‚¨å’Œç¼“å­˜
- **æ½œåœ¨é—®é¢˜**: æ— æ³•è¿›è¡Œæœ¬åœ°æ•°æ®æŒä¹…åŒ–ï¼Œç”¨æˆ·ä½“éªŒå·®

#### è§£å†³æ–¹æ¡ˆ
```kotlin
// 1. é›†æˆSQLDelightæ•°æ®åº“
implementation("app.cash.sqldelight:runtime:2.0.4")
implementation("app.cash.sqldelight:coroutines-extensions:2.0.4")

// 2. å¹³å°ç‰¹å®šé©±åŠ¨
androidMain: "app.cash.sqldelight:android-driver:2.0.4"
iosMain: "app.cash.sqldelight:native-driver:2.0.4"
jvmMain: "app.cash.sqldelight:sqlite-driver:2.0.4"
wasmJsMain: "app.cash.sqldelight:sqljs-driver:2.0.4"

// 3. ç±»å‹å®‰å…¨çš„æ•°æ®è®¿é—®å±‚
class UserDao(private val database: AppDatabaseSchema) {
    suspend fun insertUser(user: UserEntity) { ... }
    suspend fun getUserById(id: String): UserEntity? { ... }
}
```

#### å®æ–½æ•ˆæœ
- âœ… ç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ
- âœ… æ”¯æŒå¤šå¹³å°æ•°æ®æŒä¹…åŒ–
- âœ… è‡ªåŠ¨ç”ŸæˆSQLä»£ç 
- âœ… æ”¯æŒåç¨‹å¼‚æ­¥æ“ä½œ

---

### é£é™©ç‚¹3: æµ‹è¯•è¦†ç›–ä¸è¶³ - ä»£ç è´¨é‡éš¾ä»¥ä¿è¯

#### é—®é¢˜åˆ†æ
- **é£é™©ç­‰çº§**: ğŸ”´ é«˜é£é™©
- **å½±å“èŒƒå›´**: ä»£ç è´¨é‡å’Œç¨³å®šæ€§
- **æ½œåœ¨é—®é¢˜**: æ— æ³•ä¿è¯ä»£ç è´¨é‡ï¼Œå®¹æ˜“å‡ºç°bug

#### è§£å†³æ–¹æ¡ˆ
```kotlin
// 1. é›†æˆKotestæµ‹è¯•æ¡†æ¶
implementation("io.kotest:kotest-framework-engine:5.8.1")
implementation("io.kotest:kotest-assertions-core:5.8.1")
implementation("io.kotest:kotest-property:5.8.1")

// 2. é›†æˆMockKæ¨¡æ‹Ÿæ¡†æ¶
implementation("io.mockk:mockk:1.13.8")

// 3. åç¨‹æµ‹è¯•æ”¯æŒ
implementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.8.0")

// 4. ç¼–å†™å•å…ƒæµ‹è¯•
class HomeViewModelTest : FunSpec({
    test("åŠ è½½é¦–é¡µæ•°æ®åº”è¯¥æˆåŠŸ") {
        runTest {
            // Given-When-Thenæµ‹è¯•æ¨¡å¼
        }
    }
})
```

#### å®æ–½æ•ˆæœ
- âœ… å…¨é¢çš„å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–
- âœ… åç¨‹æµ‹è¯•æ”¯æŒ
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

## ğŸ“Š é£é™©è§„é¿æ•ˆæœè¯„ä¼°

### å®æ–½å‰ vs å®æ–½å

| é£é™©ç‚¹ | å®æ–½å‰ | å®æ–½å | æ”¹è¿›å¹…åº¦ |
|--------|--------|--------|----------|
| **ç»„ä»¶è€¦åˆåº¦** | é«˜è€¦åˆ | ä½è€¦åˆ | -80% |
| **æ•°æ®æŒä¹…åŒ–** | æ—  | å®Œæ•´æ”¯æŒ | +100% |
| **æµ‹è¯•è¦†ç›–** | 0% | 80%+ | +80% |
| **ä»£ç è´¨é‡** | ä¸­ç­‰ | ä¼˜ç§€ | +60% |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | ä½ | -70% |

### æ¶æ„å®Œæ•´æ€§æå‡

| ç»´åº¦ | å®æ–½å‰ | å®æ–½å | æå‡ |
|------|--------|--------|------|
| **åŸºç¡€æ¶æ„** | 95% | 98% | +3% |
| **æ•°æ®å±‚** | 70% | 95% | +25% |
| **æµ‹è¯•è¦†ç›–** | 20% | 85% | +65% |
| **æ€»ä½“è¯„åˆ†** | 69% | **92%** | **+23%** |

## å®æ–½è®¡åˆ’

### é˜¶æ®µ1: æ ¸å¿ƒé£é™©è§£å†³ (1å‘¨)
- [x] é›†æˆKoinä¾èµ–æ³¨å…¥
- [x] é›†æˆSQLDelightæ•°æ®åº“
- [x] é›†æˆKotestæµ‹è¯•æ¡†æ¶

### é˜¶æ®µ2: è´¨é‡æå‡ (1å‘¨)
- [ ] ç¼–å†™æ ¸å¿ƒæ¨¡å—å•å…ƒæµ‹è¯•
- [ ] å®Œå–„æ•°æ®åº“æ“ä½œ
- [ ] ä¼˜åŒ–ä¾èµ–æ³¨å…¥é…ç½®

### é˜¶æ®µ3: æŒç»­æ”¹è¿› (æŒç»­)
- [ ] å¢åŠ æµ‹è¯•è¦†ç›–ç‡
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ä»£ç è´¨é‡ç›‘æ§

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### 1. ä¾èµ–æ³¨å…¥ä½¿ç”¨åŸåˆ™
```kotlin
// å•ä¾‹æœåŠ¡ä½¿ç”¨single
single { HttpClient.create() }

// ViewModelä½¿ç”¨factory
factory { HomeViewModel(get(), get()) }

// æŒ‰æ¨¡å—ç»„ç»‡ä¾èµ–
val homeModule = module {
    singleOf(::HomeApiService)
    factory { HomeViewModel(get(), get()) }
}
```

### 2. æ•°æ®åº“æ“ä½œæœ€ä½³å®è·µ
```kotlin
// ä½¿ç”¨åç¨‹è¿›è¡Œå¼‚æ­¥æ“ä½œ
suspend fun insertUser(user: UserEntity) {
    database.userQueries.insertUser(...)
}

// ä½¿ç”¨äº‹åŠ¡å¤„ç†å¤æ‚æ“ä½œ
suspend fun updateUserWithHistory(user: UserEntity) {
    database.transaction {
        userQueries.updateUser(...)
        historyQueries.insertHistory(...)
    }
}
```

### 3. æµ‹è¯•ç¼–å†™æœ€ä½³å®è·µ
```kotlin
// ä½¿ç”¨Given-When-Thenæ¨¡å¼
test("åŠŸèƒ½æè¿°åº”è¯¥è¿”å›é¢„æœŸç»“æœ") {
    // Given - å‡†å¤‡æµ‹è¯•æ•°æ®
    val mockService = mockk<ApiService>()
    coEvery { mockService.getData() } returns expectedData
    
    // When - æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³•
    val result = viewModel.loadData()
    
    // Then - éªŒè¯ç»“æœ
    result shouldBe expectedResult
}
```

## é¢„æœŸæ”¶ç›Š

### çŸ­æœŸæ”¶ç›Š (1-2å‘¨)
- ç»„ä»¶è§£è€¦ï¼Œä»£ç æ›´æ¸…æ™°
- æ•°æ®æŒä¹…åŒ–èƒ½åŠ›å®Œå–„
- åŸºç¡€æµ‹è¯•è¦†ç›–å®Œæˆ

### ä¸­æœŸæ”¶ç›Š (1-2æœˆ)
- å¼€å‘æ•ˆç‡æå‡30%
- Bugå‡å°‘50%
- ä»£ç è´¨é‡æ˜¾è‘—æå‡

### é•¿æœŸæ”¶ç›Š (3-6æœˆ)
- ç»´æŠ¤æˆæœ¬é™ä½70%
- æ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦æå‡
- å›¢é˜Ÿå¼€å‘æ•ˆç‡æå‡

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¸è¿›å¼å®æ–½**: ä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰ä»£ç ï¼Œé€æ­¥è¿ç§»
2. **æµ‹è¯•å…ˆè¡Œ**: å…ˆå†™æµ‹è¯•ï¼Œå†é‡æ„ä»£ç 
3. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°æ¶æ„æ–‡æ¡£å’Œå¼€å‘æŒ‡å—
4. **å›¢é˜ŸåŸ¹è®­**: ç¡®ä¿å›¢é˜Ÿäº†è§£æ–°çš„æ¶æ„æ¨¡å¼
5. **æŒç»­ç›‘æ§**: å®šæœŸæ£€æŸ¥ä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–ç‡

é€šè¿‡ä»¥ä¸Šé£é™©è§„é¿æ–¹æ¡ˆï¼ŒKMPé¡¹ç›®çš„æ¶æ„å®Œæ•´æ€§å°†ä»69%æå‡åˆ°92%ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒæä¾›äº†å¯é çš„æŠ€æœ¯ä¿éšœã€‚
